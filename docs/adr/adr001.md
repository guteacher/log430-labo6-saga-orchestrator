# ADR 001 – Adoption du patron Saga avec orchestration pour la gestion des commandes

## Statut
Acceptée

## Contexte
Avec la transformation de l'application en architecture API, la création d'une commande implique désormais plusieurs opérations distribuées qui doivent être coordonnées :
1. Création de la commande dans le système
2. Mise à jour du stock des articles commandés
3. Traitement du paiement client

Ces opérations sont exécutées sur différents services ou composants et peuvent échouer indépendamment les unes des autres. Dans une architecture distribuée, il n'est pas possible d'utiliser les transactions ACID traditionnelles pour garantir la cohérence entre ces opérations. Si une étape échoue après que d'autres ont réussi (par exemple, le paiement échoue après la création de la commande et la diminution du stock), le système se retrouve dans un état incohérent.

Nous devons donc choisir un patron de conception approprié pour gérer ces transactions distribuées tout en maintenant la cohérence des données et en offrant une expérience utilisateur fiable.

## Décision
Nous avons décidé d'adopter le **patron Saga avec orchestration centralisée** pour coordonner les opérations de création de commande.

### Caractéristiques de l'implémentation :
- **Orchestrateur** : Une application centralisé coordonne l'ensemble du processus de création de commande
- **Machine à états** : Une classe Controller gère les états et transitions. Chaque état déclenchera l'exécution de certaines opérations.
- **Handler** : Chaque étape d'une saga encapsulée dans une classe Handler est discrète et indépendante.
- **Compensation** : Chaque Handler implémente une méthode `run()` pour exécuter une operation, et une méthode `rollback()` pour annuler l'opération en cas d'échec ultérieur 
- **Communication** : Appels HTTP/REST synchrones vers le Store Manager et Payments API
